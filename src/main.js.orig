var World = require('./world');
var Control = require('./control');
var Display = require('./graphics');
<<<<<<< HEAD

var controlOptions = {
    display: new Display(document.getElementById("canvas")),

    tc: document.getElementById("tickCounter"),
    tlcount: document.getElementById("tlCount"),
    brcount: document.getElementById("brCount"),
    tickNum: 0,
    
    outputleft: ace.edit("logboxleft"),
    outputright: ace.edit("logboxright"),

    // create the ace editors
    inputleft: ace.edit("inputleft"),
    inputright: ace.edit("inputright"),

    sourceSupplied: false,
    gameWorld: new World.World(),
    winner: 0
};

Control.init(controlOptions);

global.paused = true; // TODO export by control

controlOptions.outputleft.setTheme("ace/theme/monokai");
controlOptions.outputleft.setReadOnly(true);
global.outputleft = controlOptions.outputleft; // TODO export by control

controlOptions.outputright.setTheme("ace/theme/monokai");
controlOptions.outputright.setReadOnly(true);
global.outputright = controlOptions.outputright; // TODO export by control

controlOptions.inputleft.setTheme("ace/theme/monokai");
controlOptions.inputleft.getSession().setMode("ace/mode/javascript");

controlOptions.inputright.setTheme("ace/theme/monokai");
controlOptions.inputright.getSession().setMode("ace/mode/javascript");

controlOptions.display.render(controlOptions.gameWorld);
controlOptions.outputleft.setValue("~~ Pink Program Log ~~");
controlOptions.outputright.setValue("~~ Blue Program Log ~~");

var pausebtn = document.getElementById("play-pause");
=======
var display = new Display(document.getElementById("canvas1"),document.getElementById("canvas2"),document.getElementById("canvas3"));
// Get the elements
var tc = document.getElementById("tickCounter");
var tlcount = document.getElementById("tlCount");
var brcount = document.getElementById("brCount");
var tickNum = 0;
// Helper function
var requestAnimFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {
        window.setTimeout(callback, 100);
    };
// Create the ace editors
var inputleft = ace.edit("inputleft");
inputleft.setTheme("ace/theme/monokai");
inputleft.getSession().setMode("ace/mode/javascript");
var inputright = ace.edit("inputright");
inputright.setTheme("ace/theme/monokai");
inputright.getSession().setMode("ace/mode/javascript");
var outputleft = ace.edit("logboxleft");
outputleft.setTheme("ace/theme/monokai");
outputleft.setReadOnly(true);
global.outputleft = outputleft;
var outputright = ace.edit("logboxright");
outputright.setTheme("ace/theme/monokai");
outputright.setReadOnly(true);
global.outputright = outputright;
global.paused = true;
var sourceSupplied = false;
var gameWorld = new world.World();
var winner = 0;

function run() {
    if (paused) {
        return;
    }
    if (winner === 0) {
        winner = gameWorld.step();
        tickNum++;
    }
    display.render(gameWorld, winner);
    tc.textContent = "t = " + tickNum;
    tlcount.textContent = gameWorld.map.getSugar('tl');
    brcount.textContent = gameWorld.map.getSugar('br');
    requestAnimFrame(run);
}
var playbtn = document.getElementById("play");
playbtn.addEventListener('click', function(e) {
    if (!paused) {
        return;
    }
    paused = false;
    e.preventDefault();
    if (!sourceSupplied) {
        gameWorld.setSources(inputleft.getValue(), inputright.getValue());
        sourceSupplied = true;
    }
    run();
});
var pausebtn = document.getElementById("pause");
>>>>>>> super fast multi layer rendering WOOHOO
pausebtn.addEventListener('click', function(e) {
    e.preventDefault();
    Control.pause();
});

var restartbtn = document.getElementById("restart");
restartbtn.addEventListener('click', function(e) {
    e.preventDefault();
    Control.restart();
});
<<<<<<< HEAD

var fileuploadleft = document.getElementById("fileuploadleft");
fileuploadleft.addEventListener('change', function(e) {
  var files = e.target.files; // FileList object

  var reader = new FileReader();
  reader.onload = function(e) {
    controlOptions.inputleft.setValue(e.target.result);
  };

  reader.readAsText(files[0]);
=======
display.render(gameWorld);
outputleft.setValue("~~ Pink Program Log ~~");
outputright.setValue("~~ Blue Program Log ~~");
var fileuploadleft = document.getElementById("fileuploadleft");
fileuploadleft.addEventListener('change', function(e) {
    var files = e.target.files; // FileList object
    var reader = new FileReader();
    reader.onload = function(e) {
        inputleft.setValue(e.target.result);
    };
    reader.readAsText(files[0]);
>>>>>>> super fast multi layer rendering WOOHOO
});
var fileuploadright = document.getElementById("fileuploadright");
fileuploadright.addEventListener('change', function(e) {
<<<<<<< HEAD
  var files = e.target.files; // FileList object

  var reader = new FileReader();
  reader.onload = function(e) {
    controlOptions.inputright.setValue(e.target.result);
  };

  reader.readAsText(files[0]);
});
=======
    var files = e.target.files; // FileList object
    var reader = new FileReader();
    reader.onload = function(e) {
        inputright.setValue(e.target.result);
    };
    reader.readAsText(files[0]);
});
>>>>>>> super fast multi layer rendering WOOHOO
